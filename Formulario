<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
  <title>Formulário</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cabin&display=swap');
    
    .Form{
        width: 600px;
        margin: auto;
        border-style: solid;
        border-width: 3px;
        border-color:black;
        padding: 30px;
        margin-top: 20px;
    }
    .Botoes{
        text-align: center;
    }
    .titulo{
        text-align: center;
        color: #808080;
    }
  </STYLE>
</head>
<body>
<form name="formCadastra" id="formCadastra" method="post" class="Form">
        <h3 class="titulo">Formulário de Cadastro</h3>
        <input type="hidden" id="hdnCadastra" name="hdnCadastra" value="0">
    <div class="row">
        <div class="col">
            <div class="form-group">
                <label for="nomeCompleto">Nome Completo:</label>
                <input type="text" id="nomeCompleto" name="nomeCompleto" value="" class="form-control" onkeypress="return SomenteLetras()" maxlength="60"></imput>
            </div>
        </div>
        <div class="col">
            <div class="form-group">
                <div>
                    <label for="dataNascimento">Data de Nascimento:</label>
                    <input type="text" id="dataNascimento" name="dataNascimento" value="" class="form-control" onkeypress="formatar('##/##/####', this); return somenteNumeros(event)" onblur="ValidaData(this, event);" placeholder="dd/mm/aaaa" maxlength="10"></imput>
                </div>
            </div>
        </div>
        </div>
    </div>
    <br>
    <div class="row">
        <div class="col">
            <div class="form-group">
                <label for="selectSexo">Sexo:</label>
                <select id="selectSexo" name="selectSexo" value="" class="form-control">
                    <option value="">Selecione</option>
                    <option value="Masculino">Masculino</option>
                    <option value="Feminino">Feminino</option>
                    <option value="Outro">Outro</option>
                </select>
            </div>
        </div>
            <div class="col">
                <div class="form-group">
                    <label for="estadoCivil">Estado Civil:</label>
                    <select id="estadoCivil" name="estadoCivil" value="" class="form-control">
                        <option value="">Selecione</option>
                        <option value="Solteiro">Solteiro</option>
                        <option value="Casado">Casado</option>
                        <option value="Viúvo">Viúvo</option>
                        <option value="Divorciado">Divorciado</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
    <br>
    
    <div class="row">
        <div class="col">
            <div class="form-group">
                <label for="inputCEP">CEP:</label>
                <input type="text" id="inputCEP" name="inputCEP" value="" class="form-control" onblur="pesquisacep(this.value);" onkeypress="formatar('#####-###', this); return somenteNumeros(event)" maxlength="9"></imput>
            </div> 
        </div>
        <div class="col">
            <div class="form-group">
                <label for="inputRua">Rua:</label>
                <input type="text" id="inputRua" name="inputRua" value="" class="form-control" onkeypress="return SomenteLetras()" maxlength="60"></imput>
            </div> 
        </div>
    </div>
    <br>
    <div class="row">
        <div class="col">
            <div class="form-group">
                <label for="inputBairro">Bairro:</label>
                <input type="text" id="inputBairro" name="inputBairro" value="" class="form-control" onkeypress="return SomenteLetras()" maxlength="60"></imput>
            </div> 
        </div>
        <div class="col">
            <div class="form-group">
                <label for="selectEstado">Estado:</label>
                <select id="selectEstado" name="selectEstado" value="" class="form-control">
                        <option value="">Selecione</option>
                        <option value="AC">Acre</option>
                        <option value="AL">Alagoas</option>
                        <option value="AP">Amapá</option>
                        <option value="AM">Amazonas</option>
                        <option value="BA">Bahia</option>
                        <option value="CE">Ceará</option>
                        <option value="DF">Distrito Federal</option>
                        <option value="ES">Espírito Santo</option>
                        <option value="GO">Goiás</option>
                        <option value="MA">Maranhão</option>
                        <option value="MT">Mato Grosso</option>
                        <option value="MS">Mato Grosso do Sul</option>
                        <option value="MG">Minas Gerais</option>
                        <option value="PA">Pará</option>
                        <option value="PB">Paraíba</option>
                        <option value="PR">Paraná</option>
                        <option value="PE">Pernambuco</option>
                        <option value="PI">Piauí</option>
                        <option value="RJ">Rio de Janeiro</option>
                        <option value="RN">Rio Grande do Norte</option>
                        <option value="RS">Rio Grande do Sul</option>
                        <option value="RO">Rondônia</option>
                        <option value="RR">Roraima</option>
                        <option value="SC">Santa Catarina</option>
                        <option value="SP">São Paulo</option>
                        <option value="SE">Sergipe</option>
                        <option value="TO">Tocantins</option>
                        <option value="EX">Estrangeiro</option>
                </select>
            </div>
        </div>
    </div>
    <br>
    <div class="row">
        <div class="col">
            <div class="form-group">
                <label for="selectCidade">Cidade:</label>
                <select id="selectCidade" name="selectCidade" value="" class="form-control">
                        <option value="">Selecione</option>
                </select>
            </div>
        </div>
        <div class="col">
            <div class="form-group">
                <label for="inputEmail">E-mail:</label>
                <input type="text" id="inputEmail" name="inputEmail" value="" class="form-control" onblur="ValidaEmail(this);" maxlength="40"></imput>
            </div> 
        </div>
    </div>
    <br>

    <div class="row">
        <div class="col">
            <div class="form-group">
                <label for="nomeMae">Nome da Mãe:</label>
                <input type="text" id="nomeMae" name="nomeMae" value="" class="form-control" onkeypress="return SomenteLetras()" maxlength="60"></imput>
            </div> 
        </div>
        <div class="col">
            <div class="form-group">
                <label for="nomePai">Nome da Pai:</label>
                <input type="text" id="nomePai" name="nomePai" value="" class="form-control" onkeypress="return SomenteLetras()" maxlength="60"></imput>
            </div>  
        </div>
    </div>
    <br>
    <div class="row">
        <div class="col">
            <div class="form-group">
                <label for="inputCPF">CPF:</label>
                <input type="text" id="inputCPF" name="inputCPF" value="" class="form-control" onkeypress="formatar('###.###.###-##', this); return somenteNumeros(event)" onBlur="ValidarCPF(this);" maxlength="14"></imput>
            </div> 
        </div> 
        <div class="col">
            <div class="form-group">
                <label for="inputRG">RG:</label>
                <input type="text" id="inputRG" name="inputRG" value="" class="form-control" onkeypress="formatar('##.###.###-#', this); return somenteNumeros(event)" maxlength="12"></imput>
            </div>
        </div>
    </div>
    <br>
    <div class="row">
        <div class="col">
            <div class="form-group">
                <label for="telefoneResidencial">Telefone Residencial:</label>
                <input type="text" id="telefoneResidencial" name="telefoneResidencial" value="" class="form-control" onkeypress="formatar('## ####-####', this); return somenteNumeros(event)" maxlength="12"></imput>
            </div> 
        </div>
        <div class="col">
            <div class="form-group">
                <label for="telefoneCelular">Telefone Celular:</label>
                <input type="text" id="telefoneCelular" name="telefoneCelular" value="" class="form-control" onkeypress="formatar('## #####-####', this); return somenteNumeros(event)" maxlength="13"></imput>
            </div>
        </div>
    </div>
    <br>
    <div class="row">
        <div class="col">
            <div class="form-group, Botoes">
                <input type="button" id="btnSubmit" name="btnSubmit" value="Cadastrar" class="btn btn-secondary" onclick="confirmar()"></imput>
                <input type="reset" id="btnReset" name="btnReset" value="Limpar" class="btn btn-secondary"></imput>
            </div>
        </div>
    </div>
</form>
<script type="text/javascript">
    //Função validar Email: onkeypress="return SomenteEmail();"
    function ValidaEmail(campo){
      if(campo.value!='' && campo.value!=null)
      {
      var f = campo.value
      if((f.indexOf("@") == -1) || (f.indexOf(".") == -1) && (f != '')){
      window.alert('E-mail inválido!');
      campo.focus();
      campo.value = '';
          }
      }
}

  //Função somente números: onkeypress="return somenteNumeros(event)" ----------------------
      function somenteNumeros(e) {
      var charCode = e.charCode ? e.charCode : e.keyCode;
      // charCode 8 = backspace   
      // charCode 9 = tab
      if (charCode != 8 && charCode != 9) {
      // charCode 48 equivale a 0   
      // charCode 57 equivale a 9
      if (charCode < 48 || charCode > 57) {
      return false;
      }
      }
}
  
  
    //Função somente letras com espaço onkeypress="return SomenteLetras()" ----------------------
      function SomenteLetras(){
      var tecla=(window.event)?event.keyCode:e.which;   
      if((tecla>64 && tecla<91)) return true;
      else{
      if (tecla>96 && tecla<123 || tecla==32 || tecla==227 || tecla==241 || tecla==0245 || tecla==195 || tecla==209 || tecla==213 || tecla==231) return true;
      else  return false;
      }
  
}
  
  //Função para validar CPF: onBlur="ValidarCPF(this);" ----------------------
      function ValidarCPF (input) {
      s = input.value;
      filteredValues = ".-/"; 
      var i;
      var returnString = "";
      for (i = 0; i < s.length; i++) { 
      var c = s.charAt(i);
      if (filteredValues.indexOf(c) == -1) returnString += c;
      }
      if (returnString=='11111111111' || returnString=='22222222222' || 
      returnString=='33333333333' || returnString=='44444444444' || 
      returnString=='55555555555' || returnString=='66666666666' || 
      returnString=='77777777777' || returnString=='88888888888' || 
      returnString=='99999999999' || returnString=='00000000000' || returnString=='00000000191')
      {alert('CFP Inválido!'); input.value=""; return false;}
      if (returnString.length != 11) {sim=false}
      else {sim=true}
      if (sim ) {
      for (i=0;((i<=(returnString.length-1))&& sim); i++) {
      val = returnString.charAt(i)
      if ((val!="9")&&(val!="0")&&(val!="1")&&(val!="2")&&(val!="3")&&(val!="4")
      && (val!="5")&&(val!="6")&&(val!="7")&&(val!="8")) {sim=false}
      }
      if (sim) {
      soma = 0
      for (i=0;i<=8;i++) {
      val = eval(returnString.charAt(i))
      soma = soma + (val*(i+1))
}
      resto = soma % 11
      if (resto>9) dig = resto -10
      else  dig = resto
      if (dig != eval(returnString.charAt(9))) { sim=false }
      else { 
      soma = 0
      for (i=0;i<=7;i++) {
      val = eval(returnString.charAt(i+1))
      soma = soma + (val*(i+1))
      }
      soma = soma + (dig * 9)
      resto = soma % 11
      if (resto>9) dig = resto -10
      else  dig = resto
      if (dig != eval(returnString.charAt(10))) { sim = false }
      else {sim = true;}
}
      }
      }
      
      if (sim != true) {
      if (input.value != ''){
      alert("CPF Inválido! Digite novamente.");
      input.value = '';
      return false;
      }
      else{
      return false;  
      }	 
      }
}
  
  //Função para formatar mascára: onkeypress="formatar('###.###.###-##', this); return somenteNumeros(event)" ----------------------
      function formatar(mascara, documento){
      var i = documento.value.length;
      var saida = mascara.substring(0,1);
      var texto = mascara.substring(i)
      
      if (texto.substring(0,1) != saida){
      documento.value += texto.substring(0,1);
      
      }
}


    function limpa_formulário_cep() {
            //Limpa valores do formulário de cep.
            document.getElementById('inputRua').value=("");
            document.getElementById('inputBairro').value=("");
    }

    function meu_callback(conteudo) {
        if (!("erro" in conteudo)) {
            //Atualiza os campos com os valores.
            document.getElementById('inputRua').value=(conteudo.logradouro);
            document.getElementById('inputBairro').value=(conteudo.bairro);
        } //end if.
        else {
            //CEP não Encontrado.
            limpa_formulário_cep();
            alert("CEP não encontrado.");
        }
    }
        
    function pesquisacep(valor) {

    //Nova variável "cep" somente com dígitos.
    var cep = valor.replace(/\D/g, '');

    //Verifica se campo cep possui valor informado.
    if (cep != "") {

        //Expressão regular para validar o CEP.
        var validacep = /^[0-9]{8}$/;

        //Valida o formato do CEP.
        if(validacep.test(cep)) {

            //Preenche os campos com "..." enquanto consulta webservice.
            document.getElementById('inputRua').value="...";
            document.getElementById('inputBairro').value="...";

            //Cria um elemento javascript.
            var script = document.createElement('script');

            //Sincroniza com o callback.
            script.src = 'https://viacep.com.br/ws/'+ cep + '/json/?callback=meu_callback';

            //Insere script no documento e carrega o conteúdo.
            document.body.appendChild(script);

        } //end if.
        else {
            //cep é inválido.
            limpa_formulário_cep();
            alert("Formato de CEP inválido.");
        }
    } //end if.
    else {
        //cep sem valor, limpa formulário.
        limpa_formulário_cep();
    }
};
  
  var form = document.querySelector('.needs-validation');
  
  form.addEventListener('submit', function(event) {
  if (form.checkValidity() === false) {
    event.preventDefault();
    event.stopPropagation();
  }
    form.classList.add('was-validated');
  })
  
      //Função para preencher todos campos: onclick="confirmar()"
      function confirmar(){

      d = document.formCadastra;
      var s = new String();			
      var erro = false;

      s = '==== Para prosseguir, preencha os seguintes campos====\n\n';

      if (d.nomeCompleto.value=='' ){	s=s + '- Nome Completo \n'; erro=true}	
      if (d.dataNascimento.value=='' ){	s=s + '- Data de Nascimento \n'; erro=true}
      if (d.selectSexo.value=='' ){	s=s + '- Sexo \n'; erro=true}	
      if (d.estadoCivil.value=='' ){ s=s + '- Estado Civil \n'; erro=true}	
      if (d.inputCEP.value=='' ){	s=s + '- CEP \n'; erro=true}	
      if (d.inputRua.value=='' ){	s=s + '- Rua \n'; erro=true}
      if (d.inputBairro.value=='' ){	s=s + '- Bairro \n'; erro=true}	
      if (d.selectEstado.value=='' ){	s=s + '- Estado \n'; erro=true}
      if (d.selectCidade.value=='' ){	s=s + '- Cidade \n'; erro=true}
      if (d.inputEmail.value=='' ){	s=s + '- E-mail \n'; erro=true}	
      if (d.nomeMae.value=='' ){	s=s + '- Nome da Mãe \n'; erro=true}	
      if (d.nomePai.value=='' ){	s=s + '- Nome do Pai \n'; erro=true}
      if (d.inputCPF.value=='' ){	s=s + '- CPF \n'; erro=true}	
      if (d.inputRG.value=='' ){	s=s + '- RG \n'; erro=true}	
      if (d.telefoneResidencial.value=='' ){	s=s + '- Telefone Residencial \n'; erro=true}	
      if (d.telefoneCelular.value=='' ){	s=s + '- Telefone Celular \n'; erro=true}	
      
          
      if(erro) {alert(s);}

      else {
      d.hdnCadastra.value=1;
      window.alert('Formulário Cadastrado com Sucesso!')
      d.submit();
      }

}   
    //Função validar data
    function ValidaData(campo){
    var erro = true;
    if(campo.value != '')
    {
        var strData = campo.value;
        
        var dia = strData.substr(0,2);
        var mes = strData.substr(3,2);
        var ano = strData.substr(6,4);
        var datainteira = new String();
        datainteira = "";

        if(dia > 31)
        {
            alert("Dia inválido!");
            campo.value = "";
            return false;
        }
        datainteira = dia + '/';

        if(mes > 12)
        {
            alert("Mes inválido!");
            campo.value = "";
            return false;
        }

        datainteira  = datainteira  + mes + '/';
        if(ano < 1920 || ano>2023)
        {
            alert("Ano inválido!");
            campo.value = "";
            return false;
        }
        datainteira  = datainteira  + ano;
        if(mes == 02 && ano%4 == 0)
        {
            if(dia > 29)
            {
                alert("O mês de fevereiro em um ano bissexto so possui 29 dias!");
                campo.value = "";
                return false;
            }
        }

        if(mes == 02 && ano%4 != 0)
        {
            if(dia > 28)
            {
                alert("O mês de fevereiro so possui 28 dias!");
                campo.value = ""
                return false;
            }
        }

        if(mes != 01 || mes != 03 || mes != 05 || mes != 07 || mes != 08 || mes != 10 || mes != 12)
        {
            if(dia > 31)
            {
                alert("O Mês informado não possui 31 dias!")
                campo.value = ""
                return false;
            }
        }
        campo.value = datainteira;
    }
}
</script>
<script>
    const urlUF = 'https://servicodados.ibge.gov.br/api/v1/localidades/estados'
    const cidades = document.getElementById('selectCidade')
    const uf = document.getElementById('selectEstado')

    uf.addEventListener('change', async function(){
        const urlCidades = 'https://servicodados.ibge.gov.br/api/v1/localidades/estados/'+uf.value+'/municipios'
        const request = await fetch(urlCidades)
        const response = await request.json()
        console.log(response.length)

        let options = ''
        response.forEach(function(cidades){
            options += '<option>' +cidades.nome+'</option>'
        })
        cidades.innerHTML = options;
    })

    window.addEventListener('load', async ()=>{
        const request = await fetch(urlUF)
        const response = await request.json()
        response.sort((a, b) => a.nome.localeCompare(b.nome))

        const options = document.createElement("optgroup")
        options.setAttribute('label', 'UFs')
        response.forEach(function(uf){
            options.innerHTML += '<option>'+uf.sigla+'</option>'
        })
        uf.append(options)
    })
</script>
</body>
</html>
